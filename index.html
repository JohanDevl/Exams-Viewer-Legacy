<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover"
    />
    <title>Exams Viewer</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
    <link rel="stylesheet" href="styles.css?v=20250127" />
    <link rel="stylesheet" href="button-styles-override.css?v=20250127" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <header class="header">
        <h1><i class="fas fa-graduation-cap"></i> Exams Viewer</h1>
        <p>
          Browse and study exam questions from various certification programs
        </p>
      </header>

      <!-- Developer Info -->
      <div class="developer-info">
        <span class="developer-name">Built by Johan</span>
        <div class="developer-links">
          <a
            href="https://github.com/JohanDevl"
            target="_blank"
            class="developer-link github-link"
            data-tooltip="GitHub Profile"
            data-tooltip-position="top"
          >
            <i class="fab fa-github"></i>
          </a>
          <a
            href="https://www.raycast.com/xjo_nd?via=johan"
            target="_blank"
            class="developer-link raycast-link"
            data-tooltip="Raycast Profile"
            data-tooltip-position="top"
          >
            <img
              src="assets/raycast-icon.png"
              alt="Raycast"
              class="raycast-icon"
            />
          </a>
          <a
            href="https://github.com/JohanDevl/Exams-Viewer-Legacy/issues"
            target="_blank"
            class="bug-report-button"
            data-tooltip="Report issues or suggest improvements"
            data-tooltip-position="top"
          >
            <i class="fas fa-bug"></i>
            <span>Report a Bug</span>
          </a>
        </div>
      </div>

      <!-- Legal Disclaimer -->
      <div class="legal-disclaimer">
        <div class="disclaimer-content">
          <i class="fas fa-info-circle"></i>
          <div>
            <strong>Educational Use Only:</strong> This tool is for educational
            purposes only. All content belongs to ExamTopics.com and respective
            owners.
            <a href="#" onclick="toggleLegalInfo()" style="color: #007bff"
              >Learn more about legal compliance</a
            >
          </div>
        </div>
        <div id="legal-info" class="legal-info-expanded" style="display: none">
          <h4>Legal Information & Compliance</h4>
          <ul>
            <li>
              <strong>Content Ownership:</strong> All exam questions belong to
              their respective owners and ExamTopics.com
            </li>
            <li>
              <strong>Fair Use:</strong> Content is used under fair use
              principles for educational purposes only
            </li>
            <li>
              <strong>No Commercial Use:</strong> This tool and its content must
              not be used for commercial purposes
            </li>
            <li>
              <strong>Terms of Service:</strong> Be aware that web scraping may
              conflict with ExamTopics.com's Terms of Service
            </li>
            <li>
              <strong>Responsibility:</strong> Users assume all responsibility
              for their use of this tool
            </li>
            <li>
              <strong>Removal Requests:</strong> Content owners can request
              removal by contacting the repository owner
            </li>
          </ul>
          <p>
            <strong>Recommendation:</strong> Seek explicit permission from
            ExamTopics.com before extensive use.
          </p>
        </div>
      </div>

      <!-- Main Content -->
      <main class="main-content">
        <!-- Exam Code Input Section -->
        <div class="input-section">
          <div class="input-group">
            <button
              id="homeBtn"
              class="home-btn"
              data-tooltip="Return to Home (H)"
              data-tooltip-position="top"
              style="display: none"
            >
              <i class="fas fa-home"></i>
            </button>
            <select id="examCode" class="exam-input">
              <option value="">Select an exam...</option>
            </select>
            <div class="line-break"></div>
            <button
              id="darkModeBtn"
              class="dark-mode-btn"
              data-tooltip="Toggle Dark Mode"
              data-tooltip-position="top"
            >
              <i class="fas fa-moon"></i>
            </button>
            <button
              id="statisticsBtn"
              class="statistics-btn"
              data-tooltip="View Statistics"
              data-tooltip-position="top"
            >
              <i class="fas fa-chart-bar"></i>
            </button>
            <button
              id="settingsBtn"
              class="settings-btn"
              data-tooltip="Open Settings"
              data-tooltip-position="top"
            >
              <i class="fas fa-cog"></i>
            </button>
            <button
              id="changelogBtn"
              class="changelog-btn"
              data-tooltip="View Changelog&#10;See latest updates"
              data-tooltip-position="top"
            >
              <i class="fas fa-history"></i>
            </button>
          </div>
          <button
            id="exportBtn"
            class="export-btn"
            data-tooltip="Export Questions&#10;Choose format and options"
            data-tooltip-position="top"
            style="display: none"
          >
            <i class="fas fa-download"></i> Export Questions
          </button>
        </div>

        <!-- Loading Section -->
        <div id="loadingSection" class="loading-section" style="display: none">
          <div class="spinner"></div>
          <p>Loading questions...</p>
        </div>

        <!-- Question Navigation -->
        <div
          id="navigationSection"
          class="navigation-section"
          style="display: none"
        >
          <div class="nav-controls">
            <button
              id="prevBtn"
              class="nav-btn"
              data-tooltip="Previous Question (← or H)"
              data-tooltip-position="top"
            >
              <i class="fas fa-chevron-left"></i> Previous
            </button>
            <div class="question-info">
              <span id="questionCounter">Question 1 of 0</span>
            </div>
            <button
              id="nextBtn"
              class="nav-btn"
              data-tooltip="Next Question (→ or L)"
              data-tooltip-position="top"
            >
              Next <i class="fas fa-chevron-right"></i>
            </button>
          </div>

          <!-- Enhanced Navigation Controls -->
          <div class="nav-controls-enhanced">
            <div class="nav-history">
              <button
                id="historyBackBtn"
                class="nav-btn history"
                data-tooltip="Go Back in History&#10;Returns to previous question"
                data-tooltip-position="top"
                disabled
              >
                <i class="fas fa-undo"></i> Back
              </button>
              <button
                id="historyForwardBtn"
                class="nav-btn history"
                data-tooltip="Go Forward in History&#10;Returns to next question"
                data-tooltip-position="top"
                disabled
              >
                <i class="fas fa-redo"></i> Forward
              </button>
            </div>
            <div class="nav-quick-actions">
              <button
                id="sidebarToggle"
                class="nav-btn secondary"
                data-tooltip="Toggle Progress Sidebar&#10;View all questions at once"
                data-tooltip-position="top"
              >
                <i class="fas fa-bars"></i>
              </button>
              <button
                id="keyboardHelpBtn"
                class="nav-btn secondary"
                data-tooltip="Keyboard Shortcuts (?)&#10;View all available shortcuts"
                data-tooltip-position="top"
              >
                <i class="fas fa-keyboard"></i>
              </button>
            </div>
          </div>

          <div class="nav-controls-secondary">
            <button
              id="randomBtn"
              class="nav-btn secondary"
              data-tooltip="Random Question (R)&#10;Jump to a random question"
              data-tooltip-position="top"
            >
              <i class="fas fa-random"></i> Random
            </button>
            <div class="question-jump">
              <input
                type="number"
                id="questionJump"
                placeholder="Question number..."
                min="1"
                max="1"
                inputmode="numeric"
              />
              <button
                id="jumpBtn"
                class="nav-btn secondary"
                data-tooltip="Go to Question&#10;Navigate to specific question number"
                data-tooltip-position="top"
              >
                Go
              </button>
            </div>
          </div>
        </div>

        <!-- Enhanced Progress Indicator -->
        <div
          id="mainProgressSection"
          class="main-progress-section"
          style="display: none"
        >
          <div class="main-progress-container">
            <div class="progress-header">
              <div class="progress-info">
                <span id="mainProgressText" class="progress-text"
                  >Question 1 of 0</span
                >
                <span id="mainProgressPercentage" class="progress-percentage"
                  >0%</span
                >
              </div>
              <div class="progress-stats">
                <span class="stat answered">
                  <i class="fas fa-check-circle"></i>
                  <span id="answeredCountMain">0</span>
                </span>
                <span class="stat favorites">
                  <i class="fas fa-star"></i>
                  <span id="favoritesCountMain">0</span>
                </span>
                <span class="stat remaining">
                  <i class="far fa-circle"></i>
                  <span id="remainingCountMain">0</span>
                </span>
              </div>
            </div>
            <div class="main-progress-bar-container">
              <div class="main-progress-bar">
                <div
                  id="mainProgressFill"
                  class="progress-fill main"
                  style="width: 0%"
                  role="progressbar"
                  aria-valuenow="0"
                  aria-valuemin="0"
                  aria-valuemax="100"
                ></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Progress Sidebar -->
        <div id="progressSidebar" class="progress-sidebar">
          <div class="sidebar-header">
            <h3><i class="fas fa-list"></i> Question Progress</h3>
            <button
              id="closeSidebarBtn"
              class="close-sidebar-btn"
              data-tooltip="Close Sidebar (Esc)"
              data-tooltip-position="left"
            >
              <i class="fas fa-times"></i>
            </button>
          </div>

          <div class="sidebar-content">
            <!-- Overall Progress -->
            <div class="progress-overview">
              <div class="progress-stats">
                <span id="progressText">0/0 (0%)</span>
              </div>
              <div class="progress-bar-container">
                <div class="progress-bar">
                  <div
                    id="overallProgress"
                    class="progress-fill"
                    style="width: 0%"
                    role="progressbar"
                    aria-valuenow="0"
                    aria-valuemin="0"
                    aria-valuemax="100"
                  ></div>
                </div>
              </div>
            </div>

            <!-- Legend -->
            <div class="progress-legend">
              <div class="legend-item">
                <i class="fas fa-arrow-right current-icon"></i>
                <span>Current</span>
              </div>
              <div class="legend-item">
                <i class="fas fa-check answered-icon"></i>
                <span>Answered</span>
              </div>
              <div class="legend-item">
                <i class="fas fa-lightbulb preview-icon"></i>
                <span>Preview</span>
              </div>
              <div class="legend-item">
                <i class="far fa-circle unanswered-icon"></i>
                <span>Unanswered</span>
              </div>
              <div class="legend-item">
                <i class="fas fa-star favorite-icon"></i>
                <span>Favorite</span>
              </div>
            </div>

            <!-- Question List -->
            <div class="question-list" id="questionList">
              <!-- Questions will be populated dynamically -->
            </div>
          </div>
        </div>

        <!-- Sidebar Overlay -->
        <div id="sidebarOverlay" class="sidebar-overlay"></div>

        <!-- Advanced Search Section -->
        <div id="searchSection" class="search-section" style="display: none">
          <div id="searchHeader" class="search-header">
            <h3><i class="fas fa-search"></i> Advanced Search & Filters</h3>
            <button id="toggleSearchBtn" class="toggle-search-btn collapsed">
              <i class="fas fa-chevron-down"></i>
            </button>
          </div>
          <div id="searchContent" class="search-content collapsed">
            <div class="search-controls">
              <div class="search-input-group">
                <input
                  type="text"
                  id="questionSearch"
                  placeholder="Search in questions and answers..."
                  class="search-input"
                />
                <button id="searchBtn" class="search-btn">
                  <i class="fas fa-search"></i>
                </button>
                <button id="clearSearchBtn" class="clear-search-btn">
                  <i class="fas fa-times"></i>
                </button>
              </div>
              <div class="search-filters">
                <div class="filter-group">
                  <label class="filter-label">Status Filters:</label>
                  <div class="filter-options">
                    <label class="filter-checkbox">
                      <input type="checkbox" id="filterAnswered" />
                      <span class="checkmark"></span>
                      <span class="filter-text">Answered</span>
                      <span class="filter-count" id="answeredCount">0</span>
                    </label>
                    <label class="filter-checkbox">
                      <input type="checkbox" id="filterUnanswered" />
                      <span class="checkmark"></span>
                      <span class="filter-text">Unanswered</span>
                      <span class="filter-count" id="unansweredCount">0</span>
                    </label>
                    <label class="filter-checkbox">
                      <input type="checkbox" id="filterFavorites" />
                      <span class="checkmark"></span>
                      <span class="filter-text">Favorites</span>
                      <span class="filter-count" id="favoritesCount">0</span>
                    </label>
                  </div>
                </div>
                
                <!-- Difficulty Filters -->
                <div class="filter-group">
                  <label class="filter-label">Difficulty Filters:</label>
                  <div class="filter-options">
                    <label class="filter-checkbox">
                      <input type="checkbox" id="filterDifficultyEasy" />
                      <span class="checkmark"></span>
                      <span class="filter-text">Easy</span>
                      <span class="filter-count" id="easyCount">0</span>
                    </label>
                    <label class="filter-checkbox">
                      <input type="checkbox" id="filterDifficultyMedium" />
                      <span class="checkmark"></span>
                      <span class="filter-text">Medium</span>
                      <span class="filter-count" id="mediumCount">0</span>
                    </label>
                    <label class="filter-checkbox">
                      <input type="checkbox" id="filterDifficultyHard" />
                      <span class="checkmark"></span>
                      <span class="filter-text">Hard</span>
                      <span class="filter-count" id="hardCount">0</span>
                    </label>
                  </div>
                </div>

                <!-- Category Filters -->
                <div
                  class="filter-group"
                  id="categoryFilterGroup"
                  style="display: none"
                >
                  <label class="filter-label">Category Filters:</label>
                  <div class="filter-options" id="categoryFilterOptions">
                    <!-- Categories will be dynamically added here -->
                  </div>
                </div>
              </div>
              <div class="search-results-info">
                <span id="searchResultsCount" class="results-count">
                  Showing all questions
                </span>
                <button
                  id="resetFiltersBtn"
                  class="reset-filters-btn"
                  style="display: none"
                >
                  <i class="fas fa-undo"></i> Reset Filters
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Question Display -->
        <div
          id="questionSection"
          class="question-section"
          style="display: none"
        >
          <div class="question-header">
            <h2 id="questionTitle">Question 1</h2>
            <a id="examTopicsLink" href="#" target="_blank" class="exam-link">
              <i class="fas fa-external-link-alt"></i> View on ExamTopics
            </a>
          </div>

          <!-- Favorites Section -->
          <div class="favorites-section" id="questionToolbar">
            <div class="favorites-controls">
              <button
                id="favoriteBtn"
                class="favorite-btn"
                data-tooltip="Toggle Favorite (F)&#10;Add to your favorites"
                data-tooltip-position="top"
              >
                <i class="far fa-star"></i>
              </button>
              <select id="categorySelect" class="category-select">
                <option value="">Select category...</option>
              </select>
              <button
                id="addCategoryBtn"
                class="add-category-btn"
                data-tooltip="Add Custom Category&#10;Create new category for organization"
                data-tooltip-position="top"
              >
                <i class="fas fa-plus"></i>
              </button>
              <button
                id="noteBtn"
                class="note-btn"
                data-tooltip="Add Note (N)&#10;Write a personal note"
                data-tooltip-position="bottom"
              >
                <i class="far fa-sticky-note"></i>
              </button>
            </div>
            
            <!-- Difficulty Rating Section -->
            <div class="difficulty-rating">
              <div class="difficulty-label">Difficulty Rating:</div>
              <div class="difficulty-controls">
                <button
                  id="easyBtn"
                  class="difficulty-btn easy"
                  data-tooltip="Mark as Easy (1)&#10;Question was simple to understand"
                  data-tooltip-position="top"
                >
                  <i class="fas fa-thumbs-up"></i>
                  <span>Easy</span>
                </button>
                <button
                  id="mediumBtn"
                  class="difficulty-btn medium"
                  data-tooltip="Mark as Medium (2)&#10;Moderate difficulty level"
                  data-tooltip-position="top"
                >
                  <i class="fas fa-minus"></i>
                  <span>Medium</span>
                </button>
                <button
                  id="hardBtn"
                  class="difficulty-btn hard"
                  data-tooltip="Mark as Hard (3)&#10;Challenging question"
                  data-tooltip-position="top"
                >
                  <i class="fas fa-thumbs-down"></i>
                  <span>Hard</span>
                </button>
                <button
                  id="clearDifficultyBtn"
                  class="difficulty-btn clear"
                  data-tooltip="Clear Rating (0)&#10;Remove difficulty rating"
                  data-tooltip-position="top"
                >
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
          </div>

          <div class="question-content">
            <div id="questionText" class="question-text"></div>
          </div>

          <!-- Answer Options -->
          <div class="answers-section">
            <div id="answerInstructions" class="answer-instructions">
              <i class="fas fa-info-circle"></i>
              <span id="instructionText"
                >Click on the answers to select them</span
              >
            </div>

            <!-- Question Statistics -->
            <div
              id="questionStats"
              class="question-stats"
              style="display: none"
            >
              <div class="question-stat-item">
                <i class="fas fa-redo"></i>
                <span>Resets: <span id="resetCount">0</span></span>
              </div>
              <div class="question-stat-item">
                <i class="fas fa-lightbulb"></i>
                <span
                  >Answer previews:
                  <span id="highlightValidationsCount">0</span></span
                >
              </div>
            </div>

            <div id="answersList" class="answers-list"></div>
            <div class="answer-controls">
              <button
                id="validateBtn"
                class="validate-btn"
                data-tooltip="Validate Answers (V)&#10;Check your answers"
                data-tooltip-position="top"
              >
                <i class="fas fa-check"></i> Validate Answers
              </button>
              <button
                id="highlightBtn"
                class="highlight-btn"
                data-tooltip="Toggle Highlight (Space)&#10;Preview correct answers"
                data-tooltip-position="top"
              >
                <i class="fas fa-lightbulb"></i> Toggle Highlight
              </button>
              <button
                id="resetBtn"
                class="reset-btn"
                data-tooltip="Reset Answers&#10;Clear all selections"
                data-tooltip-position="top"
                style="display: none"
              >
                <i class="fas fa-redo"></i> Reset
              </button>
            </div>
            <div class="disclaimer-message">
              <i class="fas fa-exclamation-triangle"></i>
              <span
                >Disclaimer: The displayed answers may contain errors based on
                the scraped data. Please verify if something seems
                incorrect.</span
              >
            </div>
          </div>

          <!-- Notes Section -->
          <div
            id="questionNote"
            class="question-note-full-width"
            style="display: none"
          >
            <!-- Read-only view -->
            <div id="noteReadView" class="note-read-view">
              <div class="note-header">
                <h4><i class="fas fa-sticky-note"></i> Personal Note</h4>
              </div>
              <div id="noteDisplayText" class="note-display-text">
                No note added yet.
              </div>
              <div class="note-read-actions">
                <button id="editNoteBtn" class="edit-note-btn">
                  <i class="fas fa-edit"></i> Edit Note
                </button>
                <button id="cancelNoteViewBtn" class="cancel-note-btn">
                  <i class="fas fa-times"></i> Close
                </button>
              </div>
            </div>

            <!-- Edit view -->
            <div id="noteEditView" class="note-edit-view" style="display: none">
              <div class="note-header">
                <h4><i class="fas fa-edit"></i> Edit Note</h4>
              </div>
              <textarea
                id="noteTextarea"
                placeholder="Add your personal note here..."
                rows="6"
              ></textarea>
              <div class="note-edit-actions">
                <button id="saveNoteBtn" class="save-note-btn">
                  <i class="fas fa-save"></i> Save Note
                </button>
                <button id="cancelNoteBtn" class="cancel-note-btn">
                  <i class="fas fa-times"></i> Cancel
                </button>
              </div>
            </div>
          </div>

          <!-- Discussion Section -->
          <div class="discussion-section">
            <button
              id="discussionToggle"
              class="discussion-toggle"
              data-tooltip="Toggle Discussion (D)&#10;View community discussion"
              data-tooltip-position="top"
            >
              <i class="fas fa-comments"></i> Show Discussion
            </button>
            <div
              id="discussionContent"
              class="discussion-content"
              style="display: none"
            >
              <h3>Discussion</h3>
              <div id="discussionList"></div>
            </div>
          </div>
        </div>

        <!-- Available Exams -->
        <div id="availableExams" class="available-exams">
          <div class="exams-header">
            <h3>Available Exams</h3>
            <div class="exams-stats" id="examsStats"></div>
          </div>

          <div id="examsList" class="exams-list"></div>
        </div>
      </main>

      <!-- Statistics Modal -->
      <div id="statisticsModal" class="modal" style="display: none">
        <div class="modal-content statistics-modal">
          <div class="modal-header">
            <h2><i class="fas fa-chart-bar"></i> Statistics</h2>
            <button id="closeStatsModal" class="close-btn">
              <i class="fas fa-times"></i>
            </button>
          </div>
          <div class="modal-body">
            <div class="stats-tabs">
              <button class="stats-tab active" data-tab="overview">
                <i class="fas fa-chart-pie"></i> Overview
              </button>
              <button class="stats-tab" data-tab="exams">
                <i class="fas fa-book"></i> By Exam
              </button>
              <button class="stats-tab" data-tab="sessions">
                <i class="fas fa-history"></i> Sessions
              </button>
              <button class="stats-tab" data-tab="progress">
                <i class="fas fa-chart-line"></i> Progress
              </button>
            </div>

            <div class="stats-content">
              <!-- Overview Tab -->
              <div id="overviewTab" class="stats-tab-content active">
                <!-- Main Performance Summary -->
                <div class="overview-summary">
                  <div class="summary-header">
                    <h3>
                      <i class="fas fa-chart-line"></i> Performance Overview
                    </h3>
                    <div class="accuracy-badge" id="overallAccuracyBadge">
                      <span id="overallAccuracyPercent">0%</span>
                      <small>Overall Accuracy</small>
                    </div>
                  </div>

                  <!-- Key Metrics Grid -->
                  <div class="metrics-grid">
                    <!-- Primary Stats Row -->
                    <div class="metric-card primary">
                      <div class="metric-icon">
                        <i class="fas fa-question-circle"></i>
                      </div>
                      <div class="metric-content">
                        <div class="metric-value" id="totalQuestions">0</div>
                        <div class="metric-label">Questions Answered</div>
                        <div class="metric-trend" id="questionsTrend">
                          <small>Across all exams</small>
                        </div>
                      </div>
                    </div>

                    <div class="metric-card success">
                      <div class="metric-icon">
                        <i class="fas fa-check-circle"></i>
                      </div>
                      <div class="metric-content">
                        <div class="metric-value" id="totalCorrect">0</div>
                        <div class="metric-label">Correct Answers</div>
                        <div class="metric-trend" id="correctTrend">
                          <small id="correctPercentage">0% correct</small>
                        </div>
                      </div>
                    </div>

                    <div class="metric-card error">
                      <div class="metric-icon">
                        <i class="fas fa-times-circle"></i>
                      </div>
                      <div class="metric-content">
                        <div class="metric-value" id="totalIncorrect">0</div>
                        <div class="metric-label">Incorrect Answers</div>
                        <div class="metric-trend" id="incorrectTrend">
                          <small id="incorrectPercentage">0% incorrect</small>
                        </div>
                      </div>
                    </div>

                    <div class="metric-card warning">
                      <div class="metric-icon">
                        <i class="fas fa-eye"></i>
                      </div>
                      <div class="metric-content">
                        <div class="metric-value" id="totalPreview">0</div>
                        <div class="metric-label">Preview Mode</div>
                        <div class="metric-trend" id="previewTrend">
                          <small id="previewPercentage">0% previewed</small>
                        </div>
                      </div>
                    </div>

                    <!-- Secondary Stats Row -->
                    <div class="metric-card info">
                      <div class="metric-icon">
                        <i class="fas fa-graduation-cap"></i>
                      </div>
                      <div class="metric-content">
                        <div class="metric-value" id="totalExams">0</div>
                        <div class="metric-label">Exams Studied</div>
                        <div class="metric-trend" id="examsTrend">
                          <small>Different certifications</small>
                        </div>
                      </div>
                    </div>

                    <div class="metric-card info">
                      <div class="metric-icon">
                        <i class="fas fa-clock"></i>
                      </div>
                      <div class="metric-content">
                        <div class="metric-value" id="totalTimeSpent">0m</div>
                        <div class="metric-label">Time Studied</div>
                        <div class="metric-trend" id="timeTrend">
                          <small id="averageTimePerQuestion"
                            >0s avg/question</small
                          >
                        </div>
                      </div>
                    </div>

                    <div class="metric-card info">
                      <div class="metric-icon">
                        <i class="fas fa-calendar-alt"></i>
                      </div>
                      <div class="metric-content">
                        <div class="metric-value" id="totalSessions">0</div>
                        <div class="metric-label">Study Sessions</div>
                        <div class="metric-trend" id="sessionsTrend">
                          <small id="averageQuestionsPerSession"
                            >0 avg questions</small
                          >
                        </div>
                      </div>
                    </div>

                    <div class="metric-card secondary">
                      <div class="metric-icon">
                        <i class="fas fa-star"></i>
                      </div>
                      <div class="metric-content">
                        <div class="metric-value" id="totalFavorites">0</div>
                        <div class="metric-label">Favorites Saved</div>
                        <div class="metric-trend" id="favoritesTrend">
                          <small>Important questions</small>
                        </div>
                      </div>
                    </div>

                    <!-- Difficulty Rating Card -->
                    <div class="metric-card accent">
                      <div class="metric-icon">
                        <i class="fas fa-signal"></i>
                      </div>
                      <div class="metric-content">
                        <div class="metric-value" id="totalDifficultyRated">0</div>
                        <div class="metric-label">Difficulty Rated</div>
                        <div class="metric-trend" id="difficultyTrend">
                          <small id="difficultyBreakdown">0 easy, 0 medium, 0 hard</small>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Progress Visualization -->
                <div class="progress-visualization">
                  <h4>
                    <i class="fas fa-chart-pie"></i> Study Progress Breakdown
                  </h4>
                  <div class="progress-chart">
                    <div class="progress-bar-container">
                      <div class="progress-bar">
                        <div
                          class="progress-segment correct"
                          id="correctProgressSegment"
                          style="width: 0%"
                        ></div>
                        <div
                          class="progress-segment incorrect"
                          id="incorrectProgressSegment"
                          style="width: 0%"
                        ></div>
                        <div
                          class="progress-segment preview"
                          id="previewProgressSegment"
                          style="width: 0%"
                        ></div>
                      </div>
                      <div class="progress-labels">
                        <div class="progress-label correct">
                          <span class="color-dot"></span>
                          <span
                            >Correct (<span id="correctProgressText">0%</span
                            >)</span
                          >
                        </div>
                        <div class="progress-label incorrect">
                          <span class="color-dot"></span>
                          <span
                            >Incorrect (<span id="incorrectProgressText"
                              >0%</span
                            >)</span
                          >
                        </div>
                        <div class="progress-label preview">
                          <span class="color-dot"></span>
                          <span
                            >Preview (<span id="previewProgressText">0%</span
                            >)</span
                          >
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Exams Tab -->
              <div id="examsTab" class="stats-tab-content">
                <div id="examStatsList" class="exam-stats-list"></div>
              </div>

              <!-- Sessions Tab -->
              <div id="sessionsTab" class="stats-tab-content">
                <div id="sessionsList" class="sessions-list"></div>
              </div>

              <!-- Progress Tab -->
              <div id="progressTab" class="stats-tab-content">
                <div class="progress-charts">
                  <canvas id="progressChart" width="400" height="200"></canvas>
                </div>
              </div>
            </div>

            <div class="stats-actions">
              <button id="exportStatsBtn" class="export-stats-btn">
                <i class="fas fa-download"></i> Export Statistics
              </button>
              <button id="resetStatsBtn" class="reset-stats-btn">
                <i class="fas fa-trash"></i> Reset Statistics
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Settings Modal -->
      <div id="settingsModal" class="modal" style="display: none">
        <div class="modal-content">
          <div class="modal-header">
            <h2>Settings</h2>
            <button id="closeModal" class="close-btn">
              <i class="fas fa-times"></i>
            </button>
          </div>
          <div class="modal-body">
            <div class="setting-group">
              <h3><i class="fas fa-palette"></i> Display Preferences</h3>
              <label class="toggle-label">
                <input type="checkbox" id="darkModeToggle" />
                <span class="toggle-slider"></span>
                Dark mode
              </label>
              <label class="toggle-label">
                <input type="checkbox" id="showDiscussionDefault" />
                <span class="toggle-slider"></span>
                Show discussion by default
              </label>
              <label class="toggle-label">
                <input type="checkbox" id="highlightDefault" />
                <span class="toggle-slider"></span>
                Highlight correct answers by default
              </label>
              <label class="toggle-label">
                <input type="checkbox" id="showQuestionToolbar" />
                <span class="toggle-slider"></span>
                Show question toolbar (favorites, groups, notes)
              </label>
              <label class="toggle-label">
                <input type="checkbox" id="showAdvancedSearch" />
                <span class="toggle-slider"></span>
                Show advanced search and filters
              </label>
              <label class="toggle-label" style="margin-top: 1rem">
                <input type="checkbox" id="showMainProgressBar" />
                <span class="toggle-slider"></span>
                Show enhanced progress indicator
              </label>
              <p class="setting-description">
                Display an animated progress bar with statistics in the header
                area. Shows answered questions, favorites count, and overall
                progress percentage.
              </p>
              <label class="toggle-label" style="margin-top: 1rem">
                <input type="checkbox" id="showTooltips" />
                <span class="toggle-slider"></span>
                Show informative tooltips with keyboard shortcuts
              </label>
              <p class="setting-description">
                Display helpful tooltips on buttons and interactive elements.
                Includes keyboard shortcuts and contextual information for
                better user guidance.
              </p>
            </div>

            <div class="setting-group">
              <h3><i class="fas fa-star"></i> Favorites Management</h3>
              <div class="favorites-actions">
                <button
                  id="exportFavoritesBtn"
                  class="settings-action-btn export-btn"
                >
                  <i class="fas fa-download"></i> Export Favorites
                </button>
                <button
                  id="importFavoritesBtn"
                  class="settings-action-btn import-btn"
                >
                  <i class="fas fa-upload"></i> Import Favorites
                </button>
                <button
                  id="resetFavoritesBtn"
                  class="settings-action-btn reset-btn"
                >
                  <i class="fas fa-trash-alt"></i> Reset All Data
                </button>
                <input
                  type="file"
                  id="importFavoritesInput"
                  accept=".json"
                  style="display: none"
                />
              </div>
              <p class="setting-description">
                Export, import, or reset your favorites, custom categories, and
                question categorizations. Reset will permanently delete all
                favorites data.
              </p>
            </div>

            <div class="setting-group">
              <h3><i class="fas fa-chart-bar"></i> Statistics Management</h3>
              <div class="favorites-actions">
                <button
                  id="cleanOldStatisticsBtn"
                  class="settings-action-btn export-btn"
                >
                  <i class="fas fa-broom"></i> Clean Old Sessions
                </button>
                <button
                  id="resetStatisticsBtn"
                  class="settings-action-btn reset-btn"
                >
                  <i class="fas fa-trash-alt"></i> Reset All Statistics
                </button>
              </div>
              <p class="setting-description">
                Clean old session data to free storage space, or completely
                reset all statistics. Cleaning keeps the last 20 sessions only.
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Custom Category Modal -->
      <div id="categoryModal" class="modal" style="display: none">
        <div class="modal-content">
          <div class="modal-header">
            <h2><i class="fas fa-tags"></i> Manage Categories</h2>
            <button id="closeCategoryModal" class="close-btn">
              <i class="fas fa-times"></i>
            </button>
          </div>
          <div class="modal-body">
            <div class="category-input-group">
              <input
                type="text"
                id="newCategoryInput"
                placeholder="Enter category name..."
              />
              <button id="addNewCategoryBtn" class="add-new-category-btn">
                <i class="fas fa-plus"></i> Add
              </button>
            </div>
            <div class="custom-categories-list">
              <h3>Custom Categories</h3>
              <div id="customCategoriesList"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Enhanced Export Options Modal -->
      <div id="exportOptionsModal" class="modal" style="display: none">
        <div class="modal-content export-modal-content">
          <div class="modal-header">
            <h2><i class="fas fa-download"></i> Export Options</h2>
            <button id="closeExportModal" class="close-btn">
              <i class="fas fa-times"></i>
            </button>
          </div>
          <div class="modal-body">
            <div class="export-options-content">
              <!-- Export Format Selection -->
              <div class="export-section">
                <h3><i class="fas fa-file"></i> Export Format</h3>
                <div class="export-format-options">
                  <label class="radio-option">
                    <input
                      type="radio"
                      name="exportFormat"
                      value="pdf"
                      checked
                    />
                    <span class="radio-custom"></span>
                    <i class="fas fa-file-pdf"></i> PDF Document
                  </label>
                  <label class="radio-option">
                    <input type="radio" name="exportFormat" value="json" />
                    <span class="radio-custom"></span>
                    <i class="fas fa-file-code"></i> JSON Data
                  </label>
                  <label class="radio-option">
                    <input type="radio" name="exportFormat" value="txt" />
                    <span class="radio-custom"></span>
                    <i class="fas fa-file-alt"></i> Plain Text
                  </label>
                  <label class="radio-option">
                    <input type="radio" name="exportFormat" value="csv" />
                    <span class="radio-custom"></span>
                    <i class="fas fa-file-csv"></i> CSV Spreadsheet
                  </label>
                </div>
              </div>

              <!-- Content Filter Selection -->
              <div class="export-section">
                <h3><i class="fas fa-filter"></i> Content Filter</h3>
                <div class="export-filter-options">
                  <label class="radio-option">
                    <input
                      type="radio"
                      name="contentFilter"
                      value="all"
                      checked
                    />
                    <span class="radio-custom"></span>
                    <div class="option-main">
                      <div class="main-text">
                        <i class="fas fa-list"></i> All Questions
                      </div>
                    </div>
                  </label>
                  <label class="radio-option">
                    <input
                      type="radio"
                      name="contentFilter"
                      value="favorites"
                    />
                    <span class="radio-custom"></span>
                    <div class="option-main">
                      <div class="main-text">
                        <i class="fas fa-star"></i> Favorites Only
                      </div>
                    </div>
                  </label>
                  <label class="radio-option">
                    <input type="radio" name="contentFilter" value="answered" />
                    <span class="radio-custom"></span>
                    <div class="option-main">
                      <div class="main-text">
                        <i class="fas fa-check-circle"></i> Answered Questions
                      </div>
                    </div>
                  </label>
                  <label class="radio-option">
                    <input type="radio" name="contentFilter" value="notes" />
                    <span class="radio-custom"></span>
                    <div class="option-main">
                      <div class="main-text">
                        <i class="fas fa-sticky-note"></i> Questions with Notes
                      </div>
                    </div>
                  </label>
                  <label class="radio-option">
                    <input type="radio" name="contentFilter" value="category" />
                    <span class="radio-custom"></span>
                    <div class="option-main">
                      <div class="main-text">
                        <i class="fas fa-tag"></i> By Category
                      </div>
                    </div>
                  </label>
                </div>
              </div>

              <!-- Category Selection (shown when "By Category" is selected) -->
              <div
                class="export-section"
                id="categorySelection"
                style="display: none"
              >
                <h3><i class="fas fa-tags"></i> Select Categories</h3>
                <div class="category-checkboxes" id="exportCategoryList">
                  <!-- Categories will be populated dynamically -->
                </div>
              </div>

              <!-- Content Options -->
              <div class="export-section">
                <h3><i class="fas fa-cogs"></i> Content Options</h3>
                <div class="export-content-options">
                  <label class="checkbox-option">
                    <input type="checkbox" id="includeQuestions" checked />
                    <span class="checkbox-custom"></span>
                    <i class="fas fa-question-circle"></i> Include Questions
                  </label>
                  <label class="checkbox-option">
                    <input type="checkbox" id="includeAnswers" checked />
                    <span class="checkbox-custom"></span>
                    <i class="fas fa-check"></i> Include Answers
                  </label>
                  <label class="checkbox-option">
                    <input type="checkbox" id="includeCorrectAnswers" checked />
                    <span class="checkbox-custom"></span>
                    <i class="fas fa-check-circle"></i> Include Correct Answers
                  </label>
                  <label class="checkbox-option">
                    <input type="checkbox" id="includeDiscussions" checked />
                    <span class="checkbox-custom"></span>
                    <i class="fas fa-comments"></i> Include Discussions
                  </label>
                  <label class="checkbox-option">
                    <input type="checkbox" id="includeImages" checked />
                    <span class="checkbox-custom"></span>
                    <i class="fas fa-image"></i> Include Images
                  </label>
                  <label class="checkbox-option">
                    <input type="checkbox" id="includeUserNotes" checked />
                    <span class="checkbox-custom"></span>
                    <i class="fas fa-user-edit"></i> Include User Notes
                  </label>
                  <label class="checkbox-option">
                    <input type="checkbox" id="includeMetadata" checked />
                    <span class="checkbox-custom"></span>
                    <i class="fas fa-info-circle"></i> Include Metadata
                  </label>
                </div>
              </div>

              <!-- Export Preview -->
              <div class="export-section">
                <div class="export-preview">
                  <div class="preview-info">
                    <i class="fas fa-info-circle"></i>
                    <span id="exportPreviewText"
                      >All questions will be exported as PDF</span
                    >
                  </div>
                  <div class="preview-stats">
                    <span id="exportQuestionCount">0 questions</span>
                    <span id="exportEstimatedSize">~0 KB</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button id="cancelExportBtn" class="btn-secondary">
              <i class="fas fa-times"></i> Cancel
            </button>
            <button id="startExportBtn" class="btn-primary">
              <i class="fas fa-download"></i> Export
            </button>
          </div>
        </div>
      </div>

      <!-- Changelog Modal -->
      <div id="changelogModal" class="modal" style="display: none">
        <div class="modal-content changelog-modal-content">
          <div class="modal-header">
            <h2><i class="fas fa-history"></i> Changelog</h2>
            <button id="closeChangelogModal" class="close-btn">
              <i class="fas fa-times"></i>
            </button>
          </div>
          <div class="modal-body">
            <div id="changelogContent" class="changelog-content">
              <div class="loading-spinner">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading changelog...</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Error Messages -->
      <div id="errorMessage" class="error-message" style="display: none"></div>
      <div
        id="successMessage"
        class="success-message"
        style="display: none"
      ></div>

      <!-- Development Test Button (only visible in dev mode) -->
      <div id="devTestButton" class="dev-test-button" style="display: none">
        <button id="runTestsBtn" class="btn-dev-test">
          <i class="fas fa-flask"></i>
          Run Tests
        </button>
      </div>
    </div>

    <script type="module" src="script-modular.js"></script>
    <script>
      // Register Service Worker for intelligent caching
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker
          .register("./service-worker.js")
          .then((registration) => {
            if (
              window.location.hostname === "localhost" ||
              window.location.hostname === "127.0.0.1" ||
              window.location.hostname === "" ||
              window.location.protocol === "file:"
            ) {
              console.log("Service Worker registered:", registration);
            }

            // Listen for cache updates and service worker messages
            navigator.serviceWorker.addEventListener("message", (event) => {
              const isDev =
                window.location.hostname === "localhost" ||
                window.location.hostname === "127.0.0.1" ||
                window.location.hostname === "" ||
                window.location.protocol === "file:";

              if (event.data && event.data.type === "CACHE_UPDATED") {
                if (isDev) {
                  console.log("Cache updated for:", event.data.url);
                }
                // Could show a subtle notification to user about updated content
              }

              if (event.data && event.data.type === "SW_UPDATE_AVAILABLE") {
                if (isDev) {
                  console.log(
                    "Service Worker update available:",
                    event.data.version
                  );
                }
                // Show update notification (optional)
                showSuccess("🔄 Site update installing...", 2000);
              }

              if (event.data && event.data.type === "SW_UPDATE_COMPLETE") {
                if (isDev) {
                  console.log(
                    "Service Worker update complete:",
                    event.data.message
                  );
                }
                // Show completion notification
                showSuccess("✅ Site updated! Fresh content guaranteed.", 3000);
              }
            });
          })
          .catch((error) => {
            if (
              window.location.hostname === "localhost" ||
              window.location.hostname === "127.0.0.1" ||
              window.location.hostname === "" ||
              window.location.protocol === "file:"
            ) {
              console.log("Service Worker registration failed:", error);
            }
          });
      }
    </script>
  </body>
</html>
